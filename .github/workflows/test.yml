name: Delete Previous Run

on:
  workflow_run:
    types:
      - completed
  push:
    branches:
       feature
env:
  GITHUB_TOKEN: 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
jobs:
  delete_previous_run:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Fetch Workflow Runs
        id: fetch-runs
        run: |
          TOKEN="${{ env.GITHUB_TOKEN }}"
          RUNS=$(curl -s -H "Authorization: token $TOKEN" "https://api.github.com/repos/${{ github.repository }}/actions/runs")
          echo "::set-output name=runs::$RUNS"

      - name: Extract Previous Run ID
        id: extract-previous-id
        run: |
          RUNS="${{ steps.fetch-runs.outputs.runs }}"
          PREVIOUS_ID=$(echo "$RUNS" | jq -r '.workflow_runs[1].id')  # Change index as needed
          echo "::set-output name=previous-id::$PREVIOUS_ID"

      - name: Delete Previous Run
        if: ${{ steps.extract-previous-id.outputs.previous-id != null }}
        run: |
          TOKEN="${{ env.GITHUB_TOKEN }}"
          PREVIOUS_ID="${{ steps.extract-previous-id.outputs.previous-id }}"
          curl -X DELETE -H "Authorization: token $TOKEN" "https://api.github.com/repos/${{ github.repository }}/actions/runs/$PREVIOUS_ID"
